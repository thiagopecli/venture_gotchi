{% extends 'base.html' %}

{% load custom_filters %}

{% block title %}Análise da Turma {{ turma.codigo }} - Venture Gotchi{% endblock %}

{% block content %}
<main class="dashboard-main">
    <!-- Seção de Boas-vindas -->
    <div class="welcome-section">
        <div class="welcome-text">
            <h1>{{ turma.nome }}</h1>
            <p>Código: <strong>{{ turma.codigo }}</strong></p>
            {% if turma.descricao %}
            <p style="margin-top: 8px; color: var(--text-muted);">{{ turma.descricao }}</p>
            {% endif %}
            <div class="profile-info" style="margin-top: 12px;">
                <a href="{% url 'educador_dashboard' %}" class="btn-outline" style="padding: 8px 16px; text-decoration: none; border: 1px solid var(--border); font-size: 0.9rem;">← Voltar</a>
            </div>
        </div>
    </div>

    <!-- KPIs da Turma -->
    <section style="margin-top: 20px;">
        <div class="info-card">
            <h3 style="margin-bottom: 20px;">KPIs da Turma</h3>
            
            <div class="kpi-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="kpi-card" style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                    <small style="color: var(--text-muted); text-transform: uppercase; font-weight: 600;">Média Valuation</small>
                    <p style="font-size: 1.6rem; font-weight: 800; color: var(--primary); margin: 10px 0;">
                        {{ kpis.media_valuation|moeda_br }}
                    </p>
                </div>
                <div class="kpi-card" style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                    <small style="color: var(--text-muted); text-transform: uppercase; font-weight: 600;">Caixa Médio</small>
                    <p style="font-size: 1.6rem; font-weight: 800; color: var(--text-main); margin: 10px 0;">
                        {{ kpis.media_caixa|moeda_br }}
                    </p>
                </div>
                <div class="kpi-card" style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                    <small style="color: var(--text-muted); text-transform: uppercase; font-weight: 600;">Top Recorde</small>
                    <p style="font-size: 1.6rem; font-weight: 800; color: #28a745; margin: 10px 0;">
                        {{ kpis.maior_valuation|moeda_br }}
                    </p>
                </div>
                <div class="kpi-card" style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                    <small style="color: var(--text-muted); text-transform: uppercase; font-weight: 600;">Startups Ativas</small>
                    <p style="font-size: 1.6rem; font-weight: 800; color: var(--text-muted); margin: 10px 0;">
                        {{ kpis.total_startups|default:"0" }}
                    </p>
                </div>
                <div class="kpi-card" style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                    <small style="color: var(--text-muted); text-transform: uppercase; font-weight: 600;">Total de Alunos</small>
                    <p style="font-size: 1.6rem; font-weight: 800; color: var(--text-muted); margin: 10px 0;">
                        {{ total_alunos|default:"0" }}
                    </p>
                </div>
                <div class="kpi-card" style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                    <small style="color: var(--text-muted); text-transform: uppercase; font-weight: 600;">Turno Médio</small>
                    <p style="font-size: 1.6rem; font-weight: 800; color: var(--text-main); margin: 10px 0;">
                        {{ turno_medio|default:"0" }}
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Ranking da Turma -->
    <section style="margin-top: 20px;">
        <div class="info-card">
            <h3 style="margin-bottom: 20px;">Ranking da Turma</h3>
            <p class="hint">Top startups por valuation.</p>
            
            {% if ranking %}
            <div class="table-responsive">
                <table class="custom-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Estudante</th>
                            <th>Empresa</th>
                            <th>Turno</th>
                            <th>Valuation</th>
                            <th>Caixa</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for startup in ranking %}
                        <tr>
                            <td style="font-weight: bold;">{{ forloop.counter }}º</td>
                            <td>{{ startup.partida.usuario.username }}</td>
                            <td>{{ startup.partida.nome_empresa }}</td>
                            <td style="text-align: center;">{{ startup.turno_atual }}</td>
                            <td style="font-weight: bold; color: var(--primary);">R$ {{ startup.valuation|floatformat:0 }}</td>
                            <td>R$ {{ startup.saldo_caixa|floatformat:0 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state-container">
                <span class="empty-state">Nenhuma startup encontrada para esta turma.</span>
            </div>
            {% endif %}
        </div>
    </section>
</main>
{% endblock %}
