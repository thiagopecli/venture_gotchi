{% load static %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Jogo de simula√ß√£o de startup no Venture Gotchi">
    <meta name="keywords" content="jogo, startup, simula√ß√£o, decis√µes">
    <title>Jogando: {{ partida.nome_empresa }} - Venture Gotchi</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <header>
        <div class="header-title">Venture Gotchi: {{ partida.nome_empresa }}</div>
        <nav>
            <span>Turno Atual: {{ estado_startup.turno_atual }}</span>
            <a href="{% url 'dashboard' %}">Voltar ao Dashboard</a>
            <span class="user-greeting">| Ol√°, {{ user.username }}!</span>
        </nav>
    </header>

    <div class="game-container">
        
        <aside class="sidebar">
            <h3>M√©tricas Atuais</h3>
            
            <div class="metric-box">
                Caixa: <strong>{{ estado_startup.saldo_caixa|moeda_br }}</strong>
            </div>
            
            <div class="metric-box">
                Receita Mensal: <strong>{{ estado_startup.receita_mensal|moeda_br }}</strong>
            </div>
            
            <div class="metric-box">
                Valuation: <strong>{{ estado_startup.valuation|moeda_br }}</strong>
            </div>
            
            <div class="metric-box">
                Funcion√°rios: <strong>{{ estado_startup.funcionarios }}</strong>
            </div>
            
            <h3 class="mt-20">Hist√≥rico de Decis√µes</h3>
            <div class="historico-log">
                {% if historico_decisoes %}
                    {% for decisao in historico_decisoes %}
                        <p class="historico-item">
                            T{{ decisao.turno }}: {{ decisao.decisao_tomada }} 
                            <small>({{ decisao.data_decisao|date:"H:i" }})</small>
                        </p>
                    {% endfor %}
                {% else %}
                    <p>Nenhuma decis√£o registrada ainda.</p>
                {% endif %}
            </div>

        </aside>

        <section class="main-content">
            {% if messages %}
                <div class="inline-messages">
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}

            <h2>Pr√≥xima Decis√£o (Turno {{ estado_startup.turno_atual|add:1 }})</h2>
            
            <p class="alert alert-info">
                Atual cen√°rio: Sua startup precisa decidir se investe em marketing agressivo ou contrata um novo engenheiro s√™nior. O que voc√™ faz?
            </p>

            <form method="post" action="{% url 'salvar_jogo' partida.id %}" class="mt-20">
                {% csrf_token %}
                
                <h3>Escolha uma Op√ß√£o</h3>
                
                <div class="decision-options">
                    <label class="decision-option">
                        <input type="radio" name="decisao" value="Investir em Marketing Agressivo" required>
                        <div class="option-card">
                            <h4>üì¢ Investir em Marketing</h4>
                            <p>Aumenta a visibilidade da marca e atrai mais clientes.</p>
                            <ul>
                                <li>‚úÖ Aumenta receita mensal</li>
                                <li>‚ùå Custo: R$ 5.000</li>
                                <li>‚è±Ô∏è Impacto: Pr√≥ximos 2 turnos</li>
                            </ul>
                        </div>
                    </label>

                    <label class="decision-option">
                        <input type="radio" name="decisao" value="Contratar Engenheiro S√™nior" required>
                        <div class="option-card">
                            <h4>üë®‚Äçüíª Contratar Engenheiro</h4>
                            <p>Melhora a qualidade do produto e aumenta a produtividade.</p>
                            <ul>
                                <li>‚úÖ Melhora valuation</li>
                                <li>‚ùå Custo: R$ 8.000</li>
                                <li>‚è±Ô∏è Impacto: Imediato</li>
                            </ul>
                        </div>
                    </label>

                    <label class="decision-option">
                        <input type="radio" name="decisao" value="N√£o fazer nada (Economizar)" required>
                        <div class="option-card">
                            <h4>üí∞ Economizar</h4>
                            <p>Mant√©m o fluxo de caixa e acumula recursos.</p>
                            <ul>
                                <li>‚úÖ Preserva caixa</li>
                                <li>‚ùå Sem crescimento</li>
                                <li>‚è±Ô∏è Impacto: Nenhum</li>
                            </ul>
                        </div>
                    </label>
                </div>
                
                <input type="hidden" name="saldo_atual" value="{{ estado_startup.saldo_caixa }}">
                <button type="submit" class="btn btn-success" style="width: 100%; margin-top: 20px; padding: 15px; font-size: 16px;">
                    ‚úÖ Confirmar Decis√£o e Avan√ßar Turno
                </button>
            </form>
            
        </section>
    </div>
    
    <footer>
        <p class="text-center mt-20">Venture Gotchi - Aprendendo Empreendedorismo</p>
    </footer>

    <script>
        // Auto-dismiss para mensagens dentro do jogo
        document.addEventListener('DOMContentLoaded', function(){
            const inlines = document.querySelectorAll('.inline-messages .alert');
            inlines.forEach((el) => {
                setTimeout(()=>{
                    el.classList.add('hide');
                    setTimeout(()=> el.remove(), 600);
                }, 5000);
            });
        });
    </script>
</body>
</html>