{% extends 'base.html' %}

{% block title %} Ranking - Venture Gotchi {% endblock %}

{% block extra_css %}
<style>
    /* Estilos para o Ranking de Neg√≥cios */
    .modern-table tbody tr.highlight-row {
        background-color: rgba(255, 152, 0, 0.1) !important;
        border-left: 4px solid #ff9800;
    }

    .rank-number {
        font-weight: bold;
        width: 50px;
    }

    /* Cores do P√≥dio */
    .rank-1 { color: #FFD700; font-size: 1.2rem; } /* Ouro */
    .rank-2 { color: #C0C0C0; font-size: 1.1rem; } /* Prata */
    .rank-3 { color: #CD7F32; font-size: 1.05rem; } /* Bronze */

    .badge-tipo {
        font-size: 0.65rem;
        padding: 2px 6px;
        border-radius: 4px;
        text-transform: uppercase;
        font-weight: bold;
        display: inline-block;
        margin-top: 4px;
    }

    .badge-pj { background-color: #e3f2fd; color: #0d47a1; border: 1px solid #bbdefb; }
    .badge-pf { background-color: #f5f5f5; color: #616161; border: 1px solid #e0e0e0; }
    
    .font-bold { font-weight: 800 !important; }
    .me-badge {
        background: #ff9800;
        color: white;
        font-size: 0.6rem;
        padding: 2px 5px;
        border-radius: 3px;
        margin-left: 5px;
    }
</style>
{% endblock %}

{% block content %}
<main class="dashboard-main">
    <div class="header-container">
        <h2 class="profile-title"> {{ titulo }}</h2>
        <a href="{% url 'dashboard' %}" class="btn-back-orange">‚Üê Voltar ao Dashboard</a>
    </div>

    <section class="ranking-filter-section">
        <h3>Filtrar por:</h3>
        <div class="filter-group">
            <a href="{% url 'ranking' %}?criterio=valuation" class="filter-btn {% if criterio == 'valuation' %}active{% endif %}">Valuation</a>
            <a href="{% url 'ranking' %}?criterio=saldo" class="filter-btn {% if criterio == 'saldo' %}active{% endif %}">Saldo em Caixa</a>
            <a href="{% url 'ranking' %}?criterio=turno" class="filter-btn {% if criterio == 'turno' %}active{% endif %}">Turno Alcan√ßado</a>
            <a href="{% url 'ranking' %}?criterio=conquistas" class="filter-btn {% if criterio == 'conquistas' %}active{% endif %}">Conquistas</a>
        </div>
    </section>

    {% if startups %}
    <div class="ranking-table-container">
        <table class="modern-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Empresa</th>
                    <th>Fundador (Tipo)</th>
                    <th class="text-right">Valuation Final</th>
                    <th class="text-right">Saldo</th>
                    <th class="text-center">Turno</th>
                    <th class="text-center">Funcion√°rios</th>
                    <th class="text-center">Conquistas</th>
                </tr>
            </thead>
            <tbody>
                {% for startup in startups %}
                <tr class="{% if startup.partida.usuario == user %}highlight-row{% endif %}">
                    <td class="rank-number">
                        {% if forloop.counter == 1 %}
                            <span class="rank-1">1¬∫</span>
                        {% elif forloop.counter == 2 %}
                            <span class="rank-2">2¬∫</span>
                        {% elif forloop.counter == 3 %}
                            <span class="rank-3">3¬∫</span>
                        {% else %}
                            {{ forloop.counter }}¬∫
                        {% endif %}
                    </td>
                    <td>
                        <span class="company-name">{{ startup.partida.nome_empresa|default:startup.nome }}</span>
                        {% if startup.partida.usuario == user %}<span class="me-badge">VOC√ä</span>{% endif %}
                    </td>
                    <td>
                        {{ startup.partida.usuario.get_full_name|default:startup.partida.usuario.username }}
                        <br>
                        {% if startup.partida.usuario.is_pj %} 
                            <span class="badge-tipo badge-pj">Pessoa Jur√≠dica</span>
                        {% else %}
                            <span class="badge-tipo badge-pf">Pessoa F√≠sica</span>
                        {% endif %}
                    </td>
                    
                    <td class="text-right color-primary {% if criterio == 'valuation' %}font-bold{% endif %}">
                        <strong>R$ {{ startup.valuation|floatformat:2 }}</strong>
                    </td>
                    
                    <td class="text-right color-success {% if criterio == 'saldo' %}font-bold{% endif %}">
                        R$ {{ startup.saldo_caixa|floatformat:2 }}
                    </td>
                    
                    <td class="text-center {% if criterio == 'turno' %}font-bold{% endif %}">
                        {{ startup.turno_atual }}
                    </td>
                    
                    <td class="text-center">{{ startup.funcionarios }}</td>
                    
                    <td class="text-center {% if criterio == 'conquistas' %}font-bold{% endif %}">
                        {{ startup.total_conquistas }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div class="ranking-footer">
        <p>Exibindo top {{ startups|length }} startups ativas.</p>
        {% if user.is_educador %}
            <span class="educator-note">üí° Modo Educador: Visualiza√ß√£o total de perfis PF/PJ habilitada.</span>
        {% endif %}
    </div>

    {% else %}
    <div class="empty-state-container">
        <p class="empty-state">Ainda n√£o h√° startups ativas no ranking.</p>
    </div>
    {% endif %}
</main>
{% endblock %}